[{"action":"SET_STATE_SCHEMA","input":{"scope":"global","schema":"type ProposalState { id: OID! daoId: OID! title: String description: String proposer: String status: String createdAt: DateTime! resolvedAt: DateTime linkedTaskIds: [OID!]! }"}},{"action":"ADD_OPERATION","input":{"name":"ADD_PROPOSAL","description":"Initialize a new proposal document state.","inputSchema":"input AddProposalInput { id: OID! daoId: OID! title: String description: String proposer: String createdAt: DateTime! }","module":"main"}},{"action":"SET_OPERATION_REDUCER","input":{"operation":"ADD_PROPOSAL","reducer":"// ADD_PROPOSAL reducer (Mutative style)\nif (state.id) {\n  throw new DuplicateIdError(`Proposal with id ${action.input.id} already exists`);\n}\nstate.id = action.input.id;\nstate.daoId = action.input.daoId;\nstate.title = action.input.title || null;\nstate.description = action.input.description || null;\nstate.proposer = action.input.proposer || null;\nstate.status = \"DRAFT\";\nstate.createdAt = action.input.createdAt;\nstate.resolvedAt = null;\nstate.linkedTaskIds = [];\n"}}},{"action":"ADD_OPERATION_EXAMPLE","input":{"operation":"ADD_PROPOSAL","example":{"id":"OID:proposal:1","daoId":"OID:dao:1","title":"Upgrade treasury multisig","description":"Migrate treasury ownership to Gnosis Safe vX.","proposer":"phid:user:alice","createdAt":"2026-02-05T12:34:00Z"}}},{"action":"ADD_OPERATION","input":{"name":"UPDATE_PROPOSAL","description":"Patch proposal fields (title, description).","inputSchema":"input UpdateProposalInput { id: OID! title: String description: String }","module":"main"}},{"action":"SET_OPERATION_REDUCER","input":{"operation":"UPDATE_PROPOSAL","reducer":"// UPDATE_PROPOSAL reducer\nif (!state.id || state.id !== action.input.id) {\n  throw new EntityNotFoundError(`Proposal ${action.input.id} not found`);\n}\nif (action.input.title !== undefined) state.title = action.input.title;\nif (action.input.description !== undefined) state.description = action.input.description;\n"}}},{"action":"ADD_OPERATION","input":{"name":"SET_PROPOSAL_STATUS","description":"Set lifecycle status and optional resolvedAt.","inputSchema":"input SetProposalStatusInput { id: OID! status: String! resolvedAt: DateTime }","module":"main"}},{"action":"SET_OPERATION_REDUCER","input":{"operation":"SET_PROPOSAL_STATUS","reducer":"// SET_PROPOSAL_STATUS reducer\nconst allowed = [\"DRAFT\",\"OPEN\",\"CLOSED\",\"REJECTED\"];\nif (!state.id || state.id !== action.input.id) {\n  throw new EntityNotFoundError(`Proposal ${action.input.id} not found`);\n}\nif (!allowed.includes(action.input.status)) {\n  throw new InvalidStatusError(`Invalid status: ${action.input.status}`);\n}\nstate.status = action.input.status;\nif (action.input.resolvedAt !== undefined) state.resolvedAt = action.input.resolvedAt;\n"}}},{"action":"ADD_OPERATION","input":{"name":"LINK_TASK","description":"Attach a task id to proposal.linkedTaskIds if not present.","inputSchema":"input LinkTaskInput { id: OID! taskId: OID! }","module":"main"}},{"action":"SET_OPERATION_REDUCER","input":{"operation":"LINK_TASK","reducer":"// LINK_TASK reducer\nif (!state.id || state.id !== action.input.id) {\n  throw new EntityNotFoundError(`Proposal ${action.input.id} not found`);\n}\nif (!state.linkedTaskIds) state.linkedTaskIds = [];\nif (!state.linkedTaskIds.includes(action.input.taskId)) state.linkedTaskIds.push(action.input.taskId);\n"}}},{"action":"ADD_OPERATION_ERROR","input":{"operation":"ADD_PROPOSAL","code":"DUPLICATE_ID","name":"DuplicateIdError","description":"A proposal with the provided id already exists."}},{"action":"ADD_OPERATION_ERROR","input":{"operation":"SET_PROPOSAL_STATUS","code":"INVALID_STATUS","name":"InvalidStatusError","description":"Provided status is not a permitted value."}}]
[{"action":"SET_STATE_SCHEMA","input":{"scope":"global","schema":"type ProposalState { id: OID! daoId: OID! title: String description: String proposer: String status: String createdAt: DateTime! resolvedAt: DateTime linkedTaskIds: [OID!]! }"}},{"action":"ADD_OPERATION","input":{"name":"ADD_PROPOSAL","description":"Initialize a new proposal document state.","inputSchema":"input AddProposalInput { id: OID! daoId: OID! title: String description: String proposer: String createdAt: DateTime! }","module":"main"}},{"action":"ADD_OPERATION_EXAMPLE","input":{"operation":"ADD_PROPOSAL","example":{"id":"OID:proposal:1","daoId":"OID:dao:1","title":"Upgrade treasury multisig","description":"Migrate treasury ownership to Gnosis Safe vX.","proposer":"phid:user:alice","createdAt":"2026-02-05T12:34:00Z"}}},{"action":"ADD_OPERATION","input":{"name":"UPDATE_PROPOSAL","description":"Patch proposal fields (title, description).","inputSchema":"input UpdateProposalInput { id: OID! title: String description: String }","module":"main"}},{"action":"ADD_OPERATION","input":{"name":"SET_PROPOSAL_STATUS","description":"Set lifecycle status and optional resolvedAt.","inputSchema":"input SetProposalStatusInput { id: OID! status: String! resolvedAt: DateTime }","module":"main"}},{"action":"ADD_OPERATION","input":{"name":"LINK_TASK","description":"Attach a task id to proposal.linkedTaskIds if not present.","inputSchema":"input LinkTaskInput { id: OID! taskId: OID! }","module":"main"}},{"action":"ADD_OPERATION_ERROR","input":{"operation":"ADD_PROPOSAL","code":"DUPLICATE_ID","name":"DuplicateIdError","description":"A proposal with the provided id already exists."}},{"action":"ADD_OPERATION_ERROR","input":{"operation":"SET_PROPOSAL_STATUS","code":"INVALID_STATUS","name":"InvalidStatusError","description":"Provided status is not a permitted value."}}]
